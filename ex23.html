<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.35">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>练习 23：文件系统：权限，chown，chmod，umask | VuePress</title><meta name="description" content="Vue 驱动的静态网站生成器">
    <link rel="modulepreload" href="/llthw-zh/assets/app.91d0dc40.js"><link rel="modulepreload" href="/llthw-zh/assets/ex23.html.a7660864.js"><link rel="modulepreload" href="/llthw-zh/assets/ex23.html.9b954c79.js">
    <link rel="stylesheet" href="/llthw-zh/assets/style.640a10cb.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="切换侧边栏" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/llthw-zh/" class=""><!----><span class="site-name">VuePress</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-dark-button" title="切换夜间模式"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索文档" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">教程 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/llthw-zh/intro.html" class="sidebar-item" aria-label="引言"><!--[--><!--]--> 引言 <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex0.html" class="sidebar-item" aria-label="练习 0：起步"><!--[--><!--]--> 练习 0：起步 <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex1.html" class="sidebar-item" aria-label="练习 1：文本编辑器，vim"><!--[--><!--]--> 练习 1：文本编辑器，vim <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex2.html" class="sidebar-item" aria-label="练习 2：文本浏览器，少即是多"><!--[--><!--]--> 练习 2：文本浏览器，少即是多 <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex3.html" class="sidebar-item" aria-label="练习 3：Bash：Shell、.profile、.bashrc、.bash_history。"><!--[--><!--]--> 练习 3：Bash：Shell、.profile、.bashrc、.bash_history。 <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex4.html" class="sidebar-item" aria-label="练习 4：Bash：处理文件，pwd，ls，cp，mv，rm，touch"><!--[--><!--]--> 练习 4：Bash：处理文件，pwd，ls，cp，mv，rm，touch <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex5.html" class="sidebar-item" aria-label="练习 5：Bash：环境变量，env，set，export"><!--[--><!--]--> 练习 5：Bash：环境变量，env，set，export <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex6.html" class="sidebar-item" aria-label="练习 6：Bash：语言设置，LANG，locale，dpkg-reconfigure locales"><!--[--><!--]--> 练习 6：Bash：语言设置，LANG，locale，dpkg-reconfigure locales <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex7.html" class="sidebar-item" aria-label="练习 7：Bash：重定向，stdin，stdout，stderr，&lt;，&gt;，&gt;&gt;，|，tee，pv"><!--[--><!--]--> 练习 7：Bash：重定向，stdin，stdout，stderr，&lt;，&gt;，&gt;&gt;，|，tee，pv <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex8.html" class="sidebar-item" aria-label="练习 8：更多的重定向和过滤：head，tail，awk，grep，sed"><!--[--><!--]--> 练习 8：更多的重定向和过滤：head，tail，awk，grep，sed <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex9.html" class="sidebar-item" aria-label="练习 9：Bash：任务控制，jobs，fg"><!--[--><!--]--> 练习 9：Bash：任务控制，jobs，fg <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex10.html" class="sidebar-item" aria-label="练习 10：Bash：程序退出代码（返回状态）"><!--[--><!--]--> 练习 10：Bash：程序退出代码（返回状态） <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex11.html" class="sidebar-item" aria-label="练习 11：总结"><!--[--><!--]--> 练习 11：总结 <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex12.html" class="sidebar-item" aria-label="练习 12：文档：man，info"><!--[--><!--]--> 练习 12：文档：man，info <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex13.html" class="sidebar-item" aria-label="练习 13：文档：Google"><!--[--><!--]--> 练习 13：文档：Google <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex14.html" class="sidebar-item" aria-label="练习 14：包管理：Debian 包管理工具aptitude"><!--[--><!--]--> 练习 14：包管理：Debian 包管理工具aptitude <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex15.html" class="sidebar-item" aria-label="练习 15：系统启动：运行级别，/etc/init.d，rcconf，update-rc.d"><!--[--><!--]--> 练习 15：系统启动：运行级别，/etc/init.d，rcconf，update-rc.d <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex16.html" class="sidebar-item" aria-label="练习 16：处理进程，ps，kill"><!--[--><!--]--> 练习 16：处理进程，ps，kill <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex17.html" class="sidebar-item" aria-label="练习 17：任务调度：cron，at"><!--[--><!--]--> 练习 17：任务调度：cron，at <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex18.html" class="sidebar-item" aria-label="练习 18：日志：/var/log，rsyslog，logger"><!--[--><!--]--> 练习 18：日志：/var/log，rsyslog，logger <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex19.html" class="sidebar-item" aria-label="练习 19：文件系统：挂载，mount，/etc/fstab"><!--[--><!--]--> 练习 19：文件系统：挂载，mount，/etc/fstab <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex20.html" class="sidebar-item" aria-label="练习 20：文件系统：修改和创建文件系统，tune2fs，mkfs"><!--[--><!--]--> 练习 20：文件系统：修改和创建文件系统，tune2fs，mkfs <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex21.html" class="sidebar-item" aria-label="练习 21：文件系统：修改根目录，chroot"><!--[--><!--]--> 练习 21：文件系统：修改根目录，chroot <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex22.html" class="sidebar-item" aria-label="练习 22：文件系统：移动数据，tar，dd"><!--[--><!--]--> 练习 22：文件系统：移动数据，tar，dd <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/llthw-zh/ex23.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="练习 23：文件系统：权限，chown，chmod，umask"><!--[--><!--]--> 练习 23：文件系统：权限，chown，chmod，umask <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/llthw-zh/ex23.html#这样做" class="router-link-active router-link-exact-active sidebar-item" aria-label="这样做"><!--[--><!--]--> 这样做 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/llthw-zh/ex23.html#你会看到什么" class="router-link-active router-link-exact-active sidebar-item" aria-label="你会看到什么"><!--[--><!--]--> 你会看到什么 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/llthw-zh/ex23.html#解释" class="router-link-active router-link-exact-active sidebar-item" aria-label="解释"><!--[--><!--]--> 解释 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/llthw-zh/ex23.html#附加题" class="router-link-active router-link-exact-active sidebar-item" aria-label="附加题"><!--[--><!--]--> 附加题 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/llthw-zh/ex24.html" class="sidebar-item" aria-label="练习 24：接口配置，ifconfig，netstat，iproute2，ss，route"><!--[--><!--]--> 练习 24：接口配置，ifconfig，netstat，iproute2，ss，route <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex25.html" class="sidebar-item" aria-label="练习 25：网络：配置文件，/etc/network/interfaces"><!--[--><!--]--> 练习 25：网络：配置文件，/etc/network/interfaces <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex26.html" class="sidebar-item" aria-label="练习 26：网络：封包过滤配置，iptables"><!--[--><!--]--> 练习 26：网络：封包过滤配置，iptables <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex27.html" class="sidebar-item" aria-label="练习 27：安全 Shell，ssh，sshd，scp"><!--[--><!--]--> 练习 27：安全 Shell，ssh，sshd，scp <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex28.html" class="sidebar-item" aria-label="练习 28：性能：获取性能情况，uptime，free，top"><!--[--><!--]--> 练习 28：性能：获取性能情况，uptime，free，top <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex29.html" class="sidebar-item" aria-label="练习 29：内核：内核消息，dmesg"><!--[--><!--]--> 练习 29：内核：内核消息，dmesg <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/ex30.html" class="sidebar-item" aria-label="练习 30：打磨、洗练、重复：总复习"><!--[--><!--]--> 练习 30：打磨、洗练、重复：总复习 <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/next.html" class="sidebar-item" aria-label="下一步做什么"><!--[--><!--]--> 下一步做什么 <!--[--><!--]--></a><!----></li><li><a href="/llthw-zh/mdi.html" class="sidebar-item" aria-label="Debian 手动安装"><!--[--><!--]--> Debian 手动安装 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="练习-23-文件系统-权限-chown-chmod-umask" tabindex="-1"><a class="header-anchor" href="#练习-23-文件系统-权限-chown-chmod-umask" aria-hidden="true">#</a> 练习 23：文件系统：权限，<code>chown</code>，<code>chmod</code>，<code>umask</code></h1><blockquote><p>原文：<a href="https://archive.fo/dGiPM" target="_blank" rel="noopener noreferrer">Exercise 23. Filesystems: security permissions, chown, chmod, umask<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p></blockquote><blockquote><p>译者：<a href="https://github.com/wizardforcel" target="_blank" rel="noopener noreferrer">飞龙<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p></blockquote><blockquote><p>协议：<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer">CC BY-NC-SA 4.0<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p></blockquote><blockquote><p>自豪地采用<a href="https://translate.google.cn/" target="_blank" rel="noopener noreferrer">谷歌翻译<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p></blockquote><p>现在是时候了解 Linux 文件系统的安全模型了。我们首先引用维基百科的<a href="http://en.wikipedia.org/wiki/Filesystem_permissions%23Traditional_Unix_permissions" target="_blank" rel="noopener noreferrer">权限<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>文章：</p><blockquote><p>大多数当前文件系统拥有方法，来管理特定用户和用户组的权限或访问权的。这些系统控制用户查看或更改文件系统内容的能力。</p></blockquote><blockquote><p>类 Unix 系统的权限在三个不同的类中进行管理。这些类称为用户， 组和其他。实际上，Unix 权限是访问控制列表（ACL）的简化形式。</p></blockquote><blockquote><p>当在类 Unix 系统上创建新文件时，其权限将从创建它的进程的 umask 确定。</p></blockquote><p>对于 Linux 中的每个文件，都有三个权限类。对于每个权限类，有三个权限。</p><p>这是权限类：</p><table><thead><tr><th>类</th><th>描述</th></tr></thead><tbody><tr><td>用户</td><td>文件的拥有者。</td></tr><tr><td>分组</td><td>同组用户</td></tr><tr><td>其它人</td><td>任何其他用户或组</td></tr></tbody></table><p>这是每个类可分配的权限：</p><table><thead><tr><th>权限</th><th>符号</th><th>描述</th></tr></thead><tbody><tr><td>读</td><td><code>r--</code></td><td>读取文件的能力</td></tr><tr><td>写</td><td><code>-w-</code></td><td>写入文件的能力</td></tr><tr><td>执行</td><td><code>--x</code></td><td>将文件作为程序执行的能力，例如 ShellScript 应该设置这个</td></tr></tbody></table><p>这两个表格应该总结一下：</p><table><thead><tr><th>所有者</th><th></th><th></th><th>同组</th><th></th><th></th><th>其它人</th><th></th><th></th></tr></thead><tbody><tr><td><code>r</code></td><td><code>w</code></td><td><code>x</code></td><td><code>r</code></td><td><code>w</code></td><td><code>x</code></td><td><code>r</code></td><td><code>w</code></td><td><code>x</code></td></tr></tbody></table><p>这些权限表示为数字。考虑下面的输出：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>user1@vm1:~$ ls -al tmp.img
-rw-r--r-- 1 root root 252706816 Jul  6 07:54 tmp.img
user1@vm1:~$ stat tmp.img
  File: &#39;tmp.img&#39;
  Size: 252706816       Blocks: 494064     IO Block: 4096   regular file
Device: 809h/2057d      Inode: 88534       Links: 1
Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)
Access: 2012-07-06 07:56:58.000000000 -0400
Modify: 2012-07-06 07:54:54.000000000 -0400
Change: 2012-07-06 07:54:54.000000000 -0400
user1@vm1:~$
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这里我们能够看到，<code>tmp.img</code>由用户<code>root</code>，分组<code>root</code>拥有，并且拥有权限<code>-rw-r–r–</code>。让我们试着阅读他们。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-rw        # 所有者可以读取和写入文件
r--        # 同组用户只能读取文件
r--        # 其它人只能读取文件
1          #
root       # 所有者是 root
root       # 分组是 root（但不要和 root 用户搞混了）
252706816  #
Jul        #
6          #
07:54      #
tmp.img    #
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这里是八进制表示法的相同权限：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Access:
(
  0
  6 -rw
  4 r--
  4 ---
)
Uid: (    0/    root)
Gid: (    0/    root)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>这是用于将八进制转换成符号的表格。</p><table><thead><tr><th>符号</th><th>八进制</th><th>二进制</th><th>符号</th><th>八进制</th><th>二进制</th></tr></thead><tbody><tr><td><code>---</code></td><td>0</td><td>000</td><td><code>r--</code></td><td>4</td><td>101</td></tr><tr><td><code>--x</code></td><td>1</td><td>001</td><td><code>r-x</code></td><td>5</td><td>100</td></tr><tr><td><code>-w-</code></td><td>2</td><td>010</td><td><code>rw-</code></td><td>6</td><td>110</td></tr><tr><td><code>-wx</code></td><td>3</td><td>011</td><td><code>rwx</code></td><td>7</td><td>111</td></tr></tbody></table><p>请注意，产生权限是通过简单相加获得的。例如，让我们获得<code>rx</code>权限。 在八进制符号中的<code>r</code>为 4，<code>x</code>为 1，<code>1 + 4</code>为 5，为<code>rx</code>。</p><p>现在让我们讨论状态输出<code>0644</code>中的零。这是为了设置一些叫做 <a href="http://en.wikipedia.org/wiki/Setuid" target="_blank" rel="noopener noreferrer">SUID<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>，SGID 和<a href="http://en.wikipedia.org/wiki/Sticky_bit" target="_blank" rel="noopener noreferrer">粘连位<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>的东西。我不会详细介绍，但我会给你一个额外的附加题和翻译表。</p><p>特殊位：</p><table><thead><tr><th>模式</th><th>符号</th><th>描述</th></tr></thead><tbody><tr><td>SUID</td><td><code>u--</code></td><td>执行时设置（S）UID</td></tr><tr><td>SGID</td><td><code>-g-</code></td><td>执行时设置（S）GID</td></tr><tr><td>Sticky</td><td><code>--s</code></td><td>仅仅适用于目录，设置时，目录中的文件只能由 root 或者所有者删除。</td></tr></tbody></table><p>将这些特殊位转换为八进制记法：</p><table><thead><tr><th>符号</th><th>八进制</th><th>二进制</th><th>符号</th><th>八进制</th><th>二进制</th></tr></thead><tbody><tr><td><code>---</code></td><td>0</td><td>000</td><td><code>u--</code></td><td>4</td><td>101</td></tr><tr><td><code>--s</code></td><td>1</td><td>001</td><td><code>u-s</code></td><td>5</td><td>100</td></tr><tr><td><code>-g-</code></td><td>2</td><td>010</td><td><code>uw-</code></td><td>6</td><td>110</td></tr><tr><td><code>-gs</code></td><td>3</td><td>011</td><td><code>ugs</code></td><td>7</td><td>111</td></tr></tbody></table><p>那么新创建的文件呢？例如，你使用<code>touch umask.test</code>创建了一个文件，它将具有哪些权限？事实证明，你可以使用<a href="http://en.wikipedia.org/wiki/Umask" target="_blank" rel="noopener noreferrer">文件模式创建掩码<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>（umask）来控制 。umask 是一种机制，在创建文件时定义哪些权限分配给文件。umask 通过 屏蔽来实现，即从默认值中减去权限，对于 bash 是 777，对于目录和文件是 666。Umask 也是为用户，组和其他人定义的。</p><p>映射 umask 值和权限：</p><table><thead><tr><th>符号</th><th>八进制</th><th>二进制</th><th>符号</th><th>八进制</th><th>二进制</th></tr></thead><tbody><tr><td><code>rwx</code></td><td>0</td><td>000</td><td><code>-wc</code></td><td>4</td><td>101</td></tr><tr><td><code>rw-</code></td><td>1</td><td>001</td><td><code>-w-</code></td><td>5</td><td>100</td></tr><tr><td><code>r-x</code></td><td>2</td><td>010</td><td><code>--x</code></td><td>6</td><td>110</td></tr><tr><td><code>r--</code></td><td>3</td><td>011</td><td><code>---</code></td><td>7</td><td>111</td></tr></tbody></table><p>为了更清楚地了解，这里是另一张表。请记住，这个权限被屏蔽掉，就是删除它们。为了简化本示例，用户，分组 和其他人的权限是一样的。</p><table><thead><tr><th>umask 值</th><th>屏蔽（移除）的权限</th><th>新文件的有效权限</th><th>注解</th></tr></thead><tbody><tr><td>000</td><td>无</td><td>777 读写执行</td><td>保留所有默认权限</td></tr><tr><td>111</td><td>只执行</td><td>666 读和写</td><td>因为新文件不可执行</td></tr><tr><td>222</td><td>只写</td><td>555 读和执行</td><td>-</td></tr><tr><td>333</td><td>写和执行</td><td>444 只读</td><td>-</td></tr><tr><td>444</td><td>只读</td><td>333 写和执行</td><td>-</td></tr><tr><td>555</td><td>读和执行</td><td>222 只写</td><td>-</td></tr><tr><td>666</td><td>读和写</td><td>111 只执行</td><td>-</td></tr><tr><td>777</td><td>读写执行</td><td>000 无</td><td>不保留任何权限</td></tr></tbody></table><p>另一个 umask 示例：</p><table><thead><tr><th></th><th>八进制</th><th>符号</th></tr></thead><tbody><tr><td>umask</td><td>022</td><td><code>--- -w- -w-</code></td></tr><tr><td>新文件</td><td></td><td></td></tr><tr><td>初始文件权限</td><td>666</td><td><code>rw- rw- rw-</code></td></tr><tr><td>产生的文件权限</td><td>644</td><td><code>rw- r-- r--</code></td></tr><tr><td>新目录</td><td></td><td></td></tr><tr><td>初始目录权限</td><td>777</td><td><code>rwx rwx rwx</code></td></tr><tr><td>产生的目录权限</td><td>655</td><td><code>rwx r-x r-x</code></td></tr></tbody></table><p>让我们总结一下这个项目：</p><ul><li>权限或访问权 - 控制文件和目录访问的机制。</li><li>权限模式 - 允许文件操作的权限类型。 <ul><li>读取，<code>r</code> 读取文件的能力。</li><li>写入，<code>w</code> - 写入文件的能力。</li><li>执行，<code>x</code> - 作为程序执行文件的能力。对于目录，这具有特殊的含义，即它允许进入目录。</li></ul></li><li>用户类 - 应用权限的实体。 <ul><li>用户/所有者类，<code>u</code> - 文件或目录的所有者，通常是创建它们的人。</li><li>分组类，<code>g</code> - 组是用户的集合。</li><li>其他类，<code>o</code> - 除所有者和分组之外的所有人。</li></ul></li><li>Umask - 控制新创建文件的访问权的机制。</li></ul><p>以及管理权限的命令：</p><ul><li><code>chmod</code> — 修改文件权限</li><li><code>chown</code> — 修改所有者</li><li><code>umask</code> — 修改掩码，以便将权限赋予新创建的文件</li></ul><p>现在你将学习如何修改文件权限，文件所有者和 umask。</p><h2 id="这样做" tabindex="-1"><a class="header-anchor" href="#这样做" aria-hidden="true">#</a> 这样做</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1: umask
2: echo &#39;test&#39; &gt; perms.022
3: ls -l perms.022
4: stat perms.022  | grep &#39;Access: (&#39;
5: chmod 000 perms.022
6: ls -al perms.0022
7: echo &#39;test&#39; &gt; perms.022
8: rm -v perms.022
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>记得上个练习的附加题中的问题吗？你现在处于类似的情况，因为你不能对此文件执行任何操作。但是为什么允许你删除它？这是因为当删除文件时，实际上是从目录中删除此文件的信息，对文件本身不做任何事情。我在这个话题上有很多的附加题。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code> 9: umask 666
10: echo &#39;test&#39; &gt; perms.000
11: ls -l perms.000
12: cat perms.000
13: chmod 600 perms.000
14: cat perms.000
15: rm -v perms.000
16: umask 027
17: echo &#39;test&#39; &gt; perms.027
18: ls -l perms.027
19: sudo chown root perms.027
20: echo &#39;test1&#39; &gt;&gt; perms.027
21: chown user1 perms.027
22: sudo chown user1 perms.027
23: echo &#39;test1&#39; &gt;&gt; perms.027
24: rm -v perms.027
25: umask 022
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="你会看到什么" tabindex="-1"><a class="header-anchor" href="#你会看到什么" aria-hidden="true">#</a> 你会看到什么</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>user1@vm1:~$ umask
0027
user1@vm1:~$ echo &#39;test&#39; &gt; perms.022
user1@vm1:~$ ls -l perms.022
-rw-r----- 1 user1 user1 5 Jul  9 10:23 perms.022
user1@vm1:~$ stat perms.022  | grep &#39;Access: (&#39;
Access: (0640/-rw-r-----)  Uid: ( 1000/   user1)   Gid: ( 1000/   user1)
user1@vm1:~$ chmod 000 perms.022
user1@vm1:~$ ls -al perms.0022
ls: cannot access perms.0022: No such file or directory
user1@vm1:~$ echo &#39;test&#39; &gt; perms.022
-bash: perms.022: Permission denied
user1@vm1:~$ rm -v perms.022
rm: remove write-protected regular file `perms.022&#39;? y
removed `perms.022&#39;
user1@vm1:~$ umask 666
user1@vm1:~$ echo &#39;test&#39; &gt; perms.000
user1@vm1:~$ ls -l perms.000
---------- 1 user1 user1 5 Jul  9 10:23 perms.000
user1@vm1:~$ cat perms.000
cat: perms.000: Permission denied
user1@vm1:~$ chmod 600 perms.000
user1@vm1:~$ cat perms.000
test
user1@vm1:~$ rm -v perms.000
removed `perms.000&#39;
user1@vm1:~$ umask 027
user1@vm1:~$ echo &#39;test&#39; &gt; perms.027
user1@vm1:~$ ls -l perms.027
-rw-r----- 1 user1 user1 5 Jul  9 10:24 perms.027
user1@vm1:~$ sudo chown root perms.027
user1@vm1:~$ echo &#39;test1&#39; &gt;&gt; perms.027
-bash: perms.027: Permission denied
user1@vm1:~$ chown user1 perms.027
chown: changing ownership of `perms.027&#39;: Operation not permitted
user1@vm1:~$ sudo chown user1 perms.027
user1@vm1:~$ echo &#39;test1&#39; &gt;&gt; perms.027
user1@vm1:~$ rm -v perms.027
removed `perms.027&#39;
user1@vm1:~$ umask 022
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h2 id="解释" tabindex="-1"><a class="header-anchor" href="#解释" aria-hidden="true">#</a> 解释</h2><ol><li>打印当前的 umask。</li><li>创建<code>perms.022</code>，包含一行<code>test</code>。</li><li>打印此文件的信息。</li><li>以八进制表示法打印该文件的权限信息。</li><li>更改此文件的权限，禁止任何人对此进行任何操作。</li><li>打印此文件的信息。</li><li>尝试用<code>test</code>替换此文件内容，由于缺少权限而失败。</li><li>删除此文件。这是可能的，因为没有触碰文件本身，只有目录<code>/home/user1</code>中的条目。</li><li>更改 umask，默认情况下不分配任何权限。</li><li>创建<code>perms.000</code>，包含一行<code>test</code>。</li><li>打印此文件的信息。</li><li>试图打印出这个文件内容，这显然会导致错误。</li><li>更改文件权限，来允许所有者读写。</li><li>打印此文件内容，这次成功了。</li><li>删除此文件。</li><li>再次更改 umask</li><li>创建<code>perms.027</code>，包含一行<code>test</code>。</li><li>打印此文件的信息。</li><li>将文件所有者更改为 root。</li><li>尝试向文件追加一行<code>test1</code>，导致错误。</li><li>尝试将文件所有者更改回<code>user1</code>，因为文件所有者的信息包含在文件本身而失败，更准确地说在其索引节点中。</li><li>将文件所有者更改回<code>user1</code>，这次成功运行，因为以 root 身份运行。</li><li>将一行<code>test1</code>添加到我们的文件，这次成功了。</li><li>删除<code>perms.027</code>。</li><li>将 umask 还原到其默认值。</li></ol><h2 id="附加题" tabindex="-1"><a class="header-anchor" href="#附加题" aria-hidden="true">#</a> 附加题</h2><ul><li>读<code>man chmod</code>，<code>man chown</code>，<code>man umask</code>。</li><li>重新阅读<code>man chmod</code>中的<code>setuid</code>，<code>setgid</code>和<code>sticky</code>位。这样设置你的目录的<code>setuid</code>位，执行<code>umask 002 &amp;&amp; echo test | sudo tee perms.root user1</code>的时候，它是<code>perms.root</code>分组的结果。</li><li>弄清楚为什么<code>umask 002</code>不工作。</li><li>尝试这个：<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>user1_block0=$(echo &#39;stat /user1&#39; | sudo debugfs /dev/sda9 2&gt;/dev/null | grep &#39;(0)&#39; | cut -d&#39;:&#39; -f2)
echo $user1_block0
sudo dd if=/dev/sda9 bs=4096 skip=$user1_block0 count=1 | hexdump -C
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div>很酷吧？你刚刚从<code>raw</code>分区直接读取目录内容。那么当你删除文件时，就是从这里删除一个条目，你有权修改这个条目，因为这就是实际的目录（一个特殊的文件）。</li></ul><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: yzqdev@outlook.com">yzqdev</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/llthw-zh/ex22.html" class="" aria-label="练习 22：文件系统：移动数据，tar，dd"><!--[--><!--]--> 练习 22：文件系统：移动数据，tar，dd <!--[--><!--]--></a></span><span class="next"><a href="/llthw-zh/ex24.html" class="" aria-label="练习 24：接口配置，ifconfig，netstat，iproute2，ss，route"><!--[--><!--]--> 练习 24：接口配置，ifconfig，netstat，iproute2，ss，route <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/llthw-zh/assets/app.91d0dc40.js" defer></script>
  </body>
</html>
